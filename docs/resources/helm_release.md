---
page_title: "Resource k8sconnect_helm_release - terraform-provider-k8sconnect"
subcategory: ""
description: |-
  Manages a Helm release with inline cluster configuration, enabling single-apply cluster bootstrapping. This is a full Helm release (not just templating) - hooks execute, release history is maintained, and helm CLI commands work.
---

# Resource: k8sconnect_helm_release

Manages a Helm release with inline cluster configuration, enabling single-apply cluster bootstrapping. This is a full Helm release (not just templating) - hooks execute, release history is maintained, and helm CLI commands work.

## Example Usage - Bootstrap Cluster with Cilium

Single terraform apply to create cluster and install CNI:

```terraform
provider "k8sconnect" {}

resource "aws_eks_cluster" "main" {
  name = "my-cluster"
  # ... cluster configuration
}

resource "aws_eks_node_group" "main" {
  cluster_name = aws_eks_cluster.main.name
  # ... node group configuration
}

# Install Cilium CNI immediately - no waiting for provider configuration
resource "k8sconnect_helm_release" "cilium" {
  name       = "cilium"
  namespace  = "kube-system"
  repository = "https://helm.cilium.io/"
  chart      = "cilium"
  version    = "1.15.5"

  cluster = {
    host                   = aws_eks_cluster.main.endpoint
    cluster_ca_certificate = aws_eks_cluster.main.certificate_authority[0].data
    exec = {
      api_version = "client.authentication.k8s.io/v1"
      command     = "aws"
      args        = ["eks", "get-token", "--cluster-name", aws_eks_cluster.main.name]
    }
  }

  values = file("${path.module}/cilium-values.yaml")

  set = [
    {
      name  = "ipam.mode"
      value = "kubernetes"
    }
  ]

  create_namespace = true
  wait             = true
  atomic           = true

  depends_on = [aws_eks_node_group.main]
}
```

## Example Usage - Install from OCI Registry

Explicit credentials (CI/CD, automation):

```terraform
resource "k8sconnect_helm_release" "cert_manager" {
  name       = "cert-manager"
  namespace  = "cert-manager"
  repository = "oci://registry.example.com/charts"
  chart      = "cert-manager"
  version    = "v1.14.0"

  repository_username = var.oci_username
  repository_password = var.oci_password

  cluster            = local.cluster_connection
  create_namespace   = true
  wait               = true
}
```

## Example Usage - OCI with Docker Credential Helpers

Zero-config authentication using the Docker credential chain (ECR, GCR, ACR, GHCR).
When no explicit credentials are provided, Helm v4 automatically uses `~/.docker/config.json`
and any configured credential helpers (`docker-credential-ecr-login`, `docker-credential-gcloud`, etc.):

```terraform
resource "k8sconnect_helm_release" "app" {
  name       = "my-app"
  namespace  = "default"
  repository = "oci://123456.dkr.ecr.us-east-1.amazonaws.com"
  chart      = "my-app"
  version    = "1.0.0"

  # No username/password needed - uses docker-credential-ecr-login
  cluster          = local.cluster_connection
  create_namespace = true
}
```

## Example Usage - Local Chart with Dependencies

```terraform
resource "k8sconnect_helm_release" "app" {
  name      = "my-app"
  namespace = "default"
  chart     = "./charts/my-app"  # Local path

  dependency_update = true  # Download chart dependencies

  values = file("${path.module}/values.yaml")

  set_sensitive = [
    {
      name  = "database.password"
      value = var.db_password
    }
  ]

  cluster = local.cluster_connection
}
```

## Example Usage - Multi-Cluster Deployment

Deploy the same release to multiple clusters:

```terraform
locals {
  release_config = {
    name       = "nginx-ingress"
    namespace  = "ingress-nginx"
    repository = "https://kubernetes.github.io/ingress-nginx"
    chart      = "ingress-nginx"
    version    = "4.10.0"
  }
}

resource "k8sconnect_helm_release" "prod" {
  name       = local.release_config.name
  namespace  = local.release_config.namespace
  repository = local.release_config.repository
  chart      = local.release_config.chart
  version    = local.release_config.version

  cluster = local.prod_connection
  wait    = true
}

resource "k8sconnect_helm_release" "staging" {
  name       = local.release_config.name
  namespace  = local.release_config.namespace
  repository = local.release_config.repository
  chart      = local.release_config.chart
  version    = local.release_config.version

  cluster = local.staging_connection
  wait    = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `chart` (String) Chart name or path. For repository charts, use the chart name. For local charts, use the path to the chart directory.
- `cluster` (Attributes) Cluster connection configuration. Unlike hashicorp/helm provider, this is specified per-resource, enabling bootstrapping scenarios. (see [below for nested schema](#nestedatt--cluster))
- `name` (String) Release name. Must be unique within the namespace.

### Optional

- `atomic` (Boolean) If true, installation/upgrade process rolls back changes on failure. Defaults to false.
- `create_namespace` (Boolean) Create the namespace if it does not exist. Defaults to false.
- `dependency_update` (Boolean) Run 'helm dependency update' before installing the chart. Defaults to false.
- `description` (String) Custom description for the release. Shown in 'helm list' and release metadata.
- `disable_hooks` (Boolean) Disable Helm lifecycle hooks during install/upgrade/uninstall. Defaults to false.
- `force_destroy` (Boolean) Allow deletion even if resources have finalizers or delete protection. Use with caution. Defaults to false.
- `max_history` (Number) Maximum number of release revisions stored as Secrets. Prevents etcd bloat in long-lived clusters. Set to 0 for unlimited. Defaults to 10.
- `namespace` (String) Namespace to install the release into. Defaults to 'default'.
- `pass_credentials` (Boolean) Pass credentials to all domains when the repository URL redirects (common with Artifactory/Nexus proxies). Defaults to false.
- `registry_config_path` (String) Path to Docker/OCI registry config file for credential helper authentication. When omitted, Helm uses the default Docker config (~/.docker/config.json) which supports credential helpers for ECR, GCR, ACR, etc. Only needed when your config is in a non-standard location.
- `repository` (String) Helm repository URL (e.g., 'https://helm.cilium.io/') or OCI registry (e.g., 'oci://registry.example.com/charts'). Leave empty for local charts.
- `repository_ca_file` (String) Path to CA bundle to verify chart repository certificates.
- `repository_cert_file` (String) Path to certificate file for TLS client authentication to chart repository.
- `repository_key_file` (String) Path to key file for TLS client authentication to chart repository.
- `repository_password` (String, Sensitive) Password for chart repository authentication.
- `repository_username` (String) Username for chart repository authentication.
- `reuse_values` (Boolean) On upgrade, reuse the last release's values and merge in any overrides from 'values', 'set', etc. When false (default), values reset to chart defaults before applying overrides.
- `set` (Attributes List) Set individual values. Has higher precedence than 'values' file. (see [below for nested schema](#nestedatt--set))
- `set_list` (Attributes List) Set list values (e.g., 'ingress.hosts[0]=example.com'). (see [below for nested schema](#nestedatt--set_list))
- `set_sensitive` (Attributes List) Set individual sensitive values (passwords, tokens, etc.). Has highest precedence. (see [below for nested schema](#nestedatt--set_sensitive))
- `skip_crds` (Boolean) Skip installing CRDs. Defaults to false.
- `timeout` (String) Time to wait for operations to complete. Format: '300s', '5m', '1h'. Defaults to '300s'.
- `values` (String) Values in YAML format to merge with chart defaults. Typically used with file() function.
- `version` (String) Chart version. Can include digest for OCI charts (e.g., '1.0.0@sha256:...'). Required for OCI registries.
- `wait` (Boolean) Wait for all resources to be ready before marking the release as successful. Defaults to true. Unlike hashicorp/helm, this waits for ALL workload types including DaemonSets.
- `wait_for_jobs` (Boolean) Wait for Jobs to complete before marking the release as successful. Defaults to false.

### Read-Only

- `id` (String) Unique identifier for this Helm release (generated by the provider).
- `manifest` (String) Computed rendered manifest (multi-document YAML).
- `metadata` (Map of String) Computed release metadata (chart version, app version, etc.).
- `revision` (Number) Computed release revision number.
- `status` (String) Computed release status (deployed, failed, pending-install, etc.).

<a id="nestedatt--cluster"></a>
### Nested Schema for `cluster`

Optional:

- `client_certificate` (String, Sensitive) Client certificate for TLS authentication. Accepts PEM format or base64-encoded PEM - automatically detected.
- `client_key` (String, Sensitive) Client certificate key for TLS authentication. Accepts PEM format or base64-encoded PEM - automatically detected.
- `cluster_ca_certificate` (String, Sensitive) Root certificate bundle for TLS authentication. Accepts PEM format or base64-encoded PEM - automatically detected.
- `context` (String) Context to use from the kubeconfig. Optional when kubeconfig contains exactly one context (that context will be used automatically). Required when kubeconfig contains multiple contexts to prevent accidental connection to the wrong cluster. Error will list available contexts if not specified when required.
- `exec` (Attributes, Sensitive) Configuration for exec-based authentication. (see [below for nested schema](#nestedatt--cluster--exec))
- `host` (String) The hostname (in form of URI) of the Kubernetes API server.
- `insecure` (Boolean) Whether server should be accessed without verifying the TLS certificate.
- `kubeconfig` (String, Sensitive) Raw kubeconfig file content.
- `proxy_url` (String) URL of the proxy to use for requests.
- `token` (String, Sensitive) Token to authenticate to the Kubernetes API server.

<a id="nestedatt--cluster--exec"></a>
### Nested Schema for `cluster.exec`

Required:

- `api_version` (String) API version to use when encoding the ExecCredentials resource.
- `command` (String) Command to execute.

Optional:

- `args` (List of String) Arguments to pass when executing the plugin.
- `env` (Map of String) Environment variables to set when executing the plugin.



<a id="nestedatt--set"></a>
### Nested Schema for `set`

Required:

- `name` (String) Value name (can use dot notation for nested values, e.g., 'image.tag').
- `value` (String) Value to set.


<a id="nestedatt--set_list"></a>
### Nested Schema for `set_list`

Required:

- `name` (String) List value name.
- `value` (String) List value to set.


<a id="nestedatt--set_sensitive"></a>
### Nested Schema for `set_sensitive`

Required:

- `name` (String) Value name (can use dot notation for nested values).
- `value` (String, Sensitive) Sensitive value to set.

## Import

Import existing Helm releases into Terraform management.

### Import Format

```
context:namespace:release-name
```

Or for releases in the default namespace:

```
context:release-name
```

### Prerequisites

Set the `KUBECONFIG` environment variable:

```shell
export KUBECONFIG=~/.kube/config
```

### Import Examples

```shell
# Import from specific namespace
terraform import k8sconnect_helm_release.cilium "prod:kube-system:cilium"

# Import from default namespace
terraform import k8sconnect_helm_release.app "prod:my-app"

# Verify import
terraform plan
```

### After Import

The import will populate:
- `chart` - Chart name from the release
- `version` - Chart version
- `revision` - Current release revision
- Computed fields (manifest, status, metadata)

You must add to your configuration:
- `repository` - The Helm repository URL
- `cluster` - Connection configuration
- `values` - Any custom values (check with `helm get values <release> -n <namespace>`)

### Complete Import Example

```hcl
# 1. Run import
# export KUBECONFIG=~/.kube/config
# terraform import k8sconnect_helm_release.imported prod:default:my-app

# 2. Add resource configuration based on import output
resource "k8sconnect_helm_release" "imported" {
  name       = "my-app"
  namespace  = "default"
  repository = "https://charts.example.com"  # Add this
  chart      = "my-app"                       # Populated by import
  version    = "1.2.3"                        # Populated by import

  # Add custom values
  values = file("${path.module}/values.yaml")

  cluster = {
    kubeconfig = file("~/.kube/config")
    context    = "prod"
  }
}

# 3. Run plan to verify
# terraform plan  # Should show minimal or no changes
```

### Troubleshooting Import

**Release not found:**

Verify the release exists:

```shell
helm list -n <namespace> --kube-context <context>
```

**Context not found:**

Check available contexts:

```shell
kubectl config get-contexts
```

**After import, plan shows changes:**

Check the current values:

```shell
helm get values <release> -n <namespace>
```

Compare with your `values` configuration and adjust accordingly.
